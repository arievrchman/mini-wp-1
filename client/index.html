<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Zappress</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">
  <!-- Bootstrap core CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Design Bootstrap -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.7.4/css/mdb.min.css" rel="stylesheet">
  <link rel="stylesheet" href="./css/style.css">
  <link rel="stylesheet" href="./css/wysiwyg.css">
</head>

<body>

  <div id="app">

    <!-- Nav -->
    <nav class="navbar navbar-expand-lg navbar-light white shadow-sm">
      <div class="container">
        <a class="navbar-brand">
          <span class="my-brand">Zappress</span>
        </a>
        <div class="collapse navbar-collapse">
          <div class="navbar-nav d-flex flex-column w-100">
            <a v-if="!isLogin" class="nav-item nav-link align-self-end btn btn-md btn-outline-info rounded"
              data-toggle="modal" data-target="#getStarted" href="#">
              <span style="text-transform: none; font-size: 13px;" class="px-3">Get Started</span>
            </a>
            <a v-else class="nav-link p-0 align-self-end dropdown-toggle" id="userDropDown" data-toggle="dropdown"
              aria-haspopup="true" aria-expanded="false">
              <img src="https://mdbootstrap.com/img/Photos/Avatars/avatar-5.jpg" class="rounded-circle z-depth-0"
                alt="avatar image" height="35">
            </a>
            <div class="dropdown-menu dropdown-menu-right dropdown-secondary" aria-labelledby="userDropDown"
              style="width: 100px;">
              <a class="dropdown-item" href="" @click.prevent="createNewArticle">New Article</a>
              <a class="dropdown-item" href="" @click.prevent="">My Articles</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="" @click.prevent="signOut">Signout</a>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <!-- Nav -->

    <!-- Tags -->
    <div class="tags-bar">
      <div class="container">
        <nav class="nav text-center font-weight-bolder">
          <ul class="nav white lighten-4 py-1">
            <li v-for="(tag, index) in tags" :key="index" class="nav-item active">
              <a class="nav-link text-muted" href="" @click.prevent="findArticleByTags(tag)">{{ tag.tagName }}</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
    <!-- Tags -->

    <main role="main">

      <!-- Home -->
      <home-section v-show="mainContent" :all-articles="newArticles"></home-section>

      <!-- Read Article -->
      <read-article v-show="switchToReadArticle"></read-article>

      <!-- Create Article -->
      <create-article v-show="switchToNewArticle"></create-article>

    </main>



    <!-- Modal Intro-->
    <get-started @submit-login="submitLogin"></get-started>
    <!-- Modal Intro -->

  </div>



  <!-- MDBootstrap -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.7.4/js/mdb.min.js"></script>
  <!-- Axios -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <!--Google SignIn -->
  <script src="https://apis.google.com/js/platform.js"></script>
  <!-- Swal! -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
  <!-- Vue.js-->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://unpkg.com/vue-input-tag"></script>
  <!-- Wysiwyg -->
  <script src="./js/wysiwyg.js"></script>
  <!-- Vue filter -->
  <script src="https://cdn.jsdelivr.net/npm/vue2-filters/dist/vue2-filters.min.js"></script>
  <!-- Main Components -->
  <script src="js/components/get-started.js"></script>
  <script src="js/components/home-section.js"></script>
  <script src="js/components/create-article.js"></script>
  <script src="js/components/read-articles.js"></script>
  <!-- Modal-body Components-->
  <script src="js/components/modal-body/intro.js"></script>
  <script src="js/components/modal-body/login.js"></script>
  <script src="js/components/modal-body/signup.js"></script>

  <script>

    function initialize() {
      // gapi.load('auth2', function () {
      //   gapi.auth2.init({ client_id: '351774805751-aj60bvo38hn982qpavmohcuo9vgl4ih6.apps.googleusercontent.com' })
      //     .then(() => {
      //       renderButton();
      //     });
      // });
    }
    function renderButton() {
      gapi.signin2.render('googleSignIn', {
        'scope': 'profile email',
        'width': 233,
        'height': 50,
        'longtitle': true,
        'onsuccess': onSuccess
      });
    }
    function onSuccess(googleUser) {
      console.log('Logged in as: ' + googleUser.getBasicProfile());
      // console.log(googleUser.getAuthResponse().id_token);
    }

    let baseUrl = 'http://localhost:3000';

    const app = new Vue({
      el: '#app',
      data: {
        isLogin: false,

        modalIntro: true,
        modalLogin: false,
        modalRegister: false,

        mainContent: true,
        switchToNewArticle: false,
        switchToReadArticle: false,

        tags: [],
        newArticles: [],
      },
      created() {
        if (localStorage.getItem('token')) {
          this.checkUser();
        }
      },
      mounted() {
        gapi.load('auth2', function () {
          gapi.auth2.init({ client_id: '351774805751-aj60bvo38hn982qpavmohcuo9vgl4ih6.apps.googleusercontent.com' })
            .then(() => {
              renderButton();
            });
        });
        this.findTags();
        this.findNewArticles();
      },
      methods: {
        renderButton() {
          gapi.signin2.render('googleSignIn', {
            'scope': 'profile email',
            'width': 233,
            'height': 50,
            'longtitle': true,
            'onsuccess': onSuccess
          });
        },
        submitLogin(payload) {
          // console.log(payload);
          this.isLogin = payload;
          this.checkUser();
        },
        checkUser() {
          axios({
            method: 'get',
            url: baseUrl + '/auth',
            headers: { token: localStorage.getItem('token') }
          })
            .then(({ data }) => {
              // console.log(data);
              this.isLogin = true;
            })
            .catch(err => {
              console.log(err);
            });
        },
        signOut() {
          localStorage.removeItem('token');
          this.isLogin = false;
        },
        createNewArticle() {
          this.switchToNewArticle = true;
          this.mainContent = false;
        },
        findNewArticles() {
          axios({
            method: 'get',
            url: baseUrl + '/articles/newest'
          })
            .then(({ data }) => {
              console.log(data);
              this.newArticles = data;
            })
            .catch((err) => {
              console.log(err);
            });
        },
        findTags() {
          axios({
            method: 'get',
            url: baseUrl + '/tags'
          })
            .then(({ data }) => {
              // console.log(data);
              this.tags = data;
            })
            .catch((err) => {
              console.log(err);
            });
        },
        findArticleByTags(tag) {

        }
      },
    });
  </script>
</body>

</html>